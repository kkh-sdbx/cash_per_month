<html>

<head>
<title>Hello Google!</title>
</head>

<style>

#pingsPongs{
    background-color : cyan;
}

#ping{
    background-color : green;
}

#tableheader{
  background-color: orange;
}
</style>

<body>
  
  <div id = "pingsPongs">
        <h1> ping pond area</h1>
        <button id = "ping" color = "green"> LET'S GOOOOO!!!</button>
        <img id = "apiImage"> </img>
        <button id = "getAPI">!! GET API !!</button>

  </div>  
  
  <div>
  <table id="searchResult">
    <tr id ="tableheader">
      <tr>공고월</tr>
      <tr>고객사</tr>
      <tr>사업명</tr>
      <tr>금액</tr>
      <tr>제출일시</tr>
      <tr>URL</tr>
    </tr>
  
  </table>
  </div>

</body>

<script type ="module">
  const ping = document.getElementById("ping");
  const getAPI= document.getElementById("getAPI");
  const searchResult= document.getElementById("searchResult");

  const updateSearchResult = (data)=>{
    /*
    "공고월" : rcptDt,
    
    
    "금액" :totCnstwkScleAmt,
    
    
    */

    for(let i=0;i<11;i++){
      let added_tr = document.createElement("tr");

      //"공고월" : rcptDt,
      let biz_month = document.createElement("td");
      biz_month.innerHTML = data.response.body.items[i].orderInsttNm;

      // "고객사" : orderInsttNm,
      let biz_org = document.createElement("td");
      biz_org.innerHTML = data.response.body.items[i].orderInsttNm;

      //"사업명" : prcrmntReqNm,
      let biz_name = document.createElement("td");
      biz_name.innerHTML = data.response.body.items[i].prcrmntReqNm;

      //"금액" : totCnstwkScleAmt,
      let biz_price = document.createElement("td");
      biz_price.innerHTML = data.response.body.items[i].totCnstwkScleAmt;

      //"제출일시" : inptDt,
      let biz_dueDate = document.createElement("td");
      biz_dueDate.innerHTML = data.response.body.items[i].inptDt;

      //"URL" : prcrmntReqInfoUrl
      let biz_url = document.createElement("td"); 
      biz_url.innerHTML = data.response.body.items[i].prcrmntReqInfoUrl;

      added_tr.appendChild(biz_month);
      added_tr.appendChild(biz_org);
      added_tr.appendChild(biz_name);
      added_tr.appendChild(biz_price);
      added_tr.appendChild(biz_dueDate);
      added_tr.appendChild(biz_url);

      searchResult.appendChild(added_tr);
    }
    
  };

  ping.addEventListener("click", async ()=>{
	try{
		const response = await fetch("/justGet");

		if(!response.ok){
			throw new Error("something is wrong!" + response.status);
		}

		const data = await response.json();
		console.log(data);
    updateSearchResult(data);

	}
	catch(error){
		console.error("error: ", error );


	}

  });
  getAPI.addEventListener("click", async ()=>{
	try{
		const response = await fetch("/getAPI");

		if(!response.ok){
			throw new Error("something is wrong!" + response.status);
		}

		const data = await response.json();
		console.log(response);
		console.log(data);
	}
	catch(error){
		console.error("error: ", error );


	}

  });
</script>
</html>
